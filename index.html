<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
    <ul>
        <li><a class="active" href="index.html">ChatBot</a></li>
        <li><a href="visualizations.html">Visualizations</a></li>
       
      </ul>
    <div class="container">
        
        <div class="row mt-1">

            <div class="col-sm-8 offset-1 bg-white p-3" id="outer">
                <h2 class="display-4 font-weight-normal">IR ChatBot</h2>
                <div class="main"></div>
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" id="inp_text" style="height: 50px;" />
                    <div class="input-group-append">
                        <button class="btn btn-primary btn-lg" id="send"><i class="far fa-paper-plane"></i></button>

                    </div>

                </div>

            </div>
            <div class="mainTopic">
                <h3>Topics</h3>
                <div class="input-group">
                    <script language="JavaScript">
                        function toggle(source) {
                            checkboxes = document.getElementsByName('foo');
                            for (var i = 0, n = checkboxes.length; i < n; i++) {
                                checkboxes[i].checked = source.checked;
                            }
                        }
                    </script>
                    <label class="container">
                        <input type="checkbox" name="foo" id="Politics">
                        <span class="checkmark">Politics</span>
                    </label>
                    <label class="container">
                        <input type="checkbox" name="foo" id="Education">
                        <span class="checkmark">Education</span>
                    </label>
                    <label class="container">
                        <input type="checkbox" name="foo" id="Technology">
                        <span class="checkmark">Technology</span>
                    </label>
                    <label class="container">
                        <input type="checkbox" name="foo" id="Environment">
                        <span class="checkmark">Environment</span>
                    </label>
                    <label class="container">
                        <input type="checkbox" name="foo" id="Healthcare">
                        <span class="checkmark">Healthcare</span>
                    </label>
                    <br>
                    <br>
                    <label class="container">
                        <input type="checkbox" onClick="toggle(this)" name="foo">
                        <span class="checkmark">All Topics</span>
                    </label>
                </div>

            </div>

        </div>

    </div>






    <!-- ChatBot  JavaScript  -->

    <script>
        var prevTopics = []
        document.getElementById("inp_text").focus();
        document.getElementsByTagName("body")[0].addEventListener("keypress", function (e) {
            if (e.key == "Enter") {
                send();
            }
        });
        document.getElementById("send").addEventListener("click", send);
        async function send() {
            var text = document.getElementById("inp_text").value;
            if (text == "") {
            }
            else {
                var topics = []
                

                var topicCheckBoxes = document.getElementsByName('foo');
                for (var i = 0, n = topicCheckBoxes.length; i < n; i++) {
                    if (topicCheckBoxes[i].checked && topicCheckBoxes[i].id)
                        topics.push(topicCheckBoxes[i].id)
                }

                var request = document.createElement("div");
                request.className = "request";
                request.innerText = text;

                document.getElementsByClassName("main")[0].appendChild(request);
                document.getElementById("inp_text").value = "";



                const myLink = new URL("http://192.168.1.62:105/chat");

                // const myArray = topics;
                // let apiUrl = `${myLink}/`;

                // myArray.forEach((x, i) => {
                //     if (i === 0) {
                //         apiUrl += `[${x}`;
                //     } else {
                //         apiUrl += `,${x}`;
                //     }
                // });
                // apiUrl += `]&${text}`

                fetch(myLink, {
                    method: 'POST',
                    // headers: {
                    //     'Content-Type': 'application/json',
                    // },
                    body: JSON.stringify({ "query": text,"topics":topics,"topicIdentified":prevTopics})
                })
                    .then(response => response.json())
                    .then(function (data) {
                        prevTopics = data['topicIdentified']
                        res = data['response']
                        var response = document.createElement("div");
                        response.className = "response";
                        response.innerText = res;

                        setTimeout(function () {
                            document.getElementsByClassName("main")[0].appendChild(response);
                            var a = document.getElementsByClassName("main")[0].scrollHeight;
                            document.getElementsByClassName("main")[0].scrollTop = a + 100;
                        }, 1000)
                    });



            }

            var a = document.getElementsByClassName("main")[0].scrollHeight;
            document.getElementsByClassName("main")[0].scrollTop = a;
        };




    </script>


</body>

</html>